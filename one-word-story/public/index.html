<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이야기 생성기</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter 폰트 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* 로딩 스피너 애니메이션 */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NXEW5H90P4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NXEW5H90P4');
</script>
</head>
<body class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-purple-100 to-indigo-200">
    <div id="root" class="w-full max-w-2xl">
        <!-- React 앱이 여기에 렌더링됩니다 -->
    </div>

    <!-- React 및 ReactDOM CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel CDN (JSX 변환용) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const App = () => {
            const [inputWord, setInputWord] = React.useState('');
            const [story, setStory] = React.useState('');
            const [isLoading, setIsLoading] = React.useState(false);
            const [error, setError] = React.useState('');

            const generateStory = async () => {
                if (!inputWord.trim()) {
                    setError('단어를 입력해주세요.');
                    return;
                }

                setIsLoading(true);
                setStory('');
                setError('');

                try {
                    const prompt = `"${inputWord}"이라는 단어를 포함하는 짧고 창의적인 이야기를 한국어로 작성해주세요. 이야기는 최소 50단어 이상이어야 합니다.`;

                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                    const payload = { contents: chatHistory };
                    // API 키는 Canvas 환경에서 자동으로 제공됩니다.
                    const apiKey = "AIzaSyDT_gy2myWyUQFwiUeCdtusaVvoqIU4BFQ";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const generatedText = result.candidates[0].content.parts[0].text;
                        setStory(generatedText);
                    } else {
                        setError('이야기를 생성하는 데 실패했습니다. 다시 시도해주세요.');
                        console.error('API 응답 구조가 예상과 다릅니다:', result);
                    }
                } catch (err) {
                    setError('이야기를 생성하는 중 오류가 발생했습니다: ' + err.message);
                    console.error('API 호출 오류:', err);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="p-4">
                    <h1 className="text-4xl font-extrabold text-center text-gray-800 mb-6">
                        이야기 생성기
                    </h1>
                    <p className="text-center text-gray-600 mb-8">
                        단어 하나를 입력하면 AI가 그 단어로 멋진 이야기를 만들어 드립니다!
                    </p>

                    <div className="flex flex-col sm:flex-row gap-4 mb-6">
                        <input
                            type="text"
                            className="flex-grow p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-gray-800 placeholder-gray-400"
                            placeholder="여기에 단어를 입력하세요 (예: 마법, 우주선, 꿈)"
                            value={inputWord}
                            onChange={(e) => setInputWord(e.target.value)}
                            onKeyPress={(e) => {
                                if (e.key === 'Enter') {
                                    generateStory();
                                }
                            }}
                            disabled={isLoading}
                        />
                        <button
                            onClick={generateStory}
                            className="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition duration-200 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                            disabled={isLoading}
                        >
                            {isLoading ? (
                                <svg className="animate-spin h-5 w-5 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                            ) : (
                                '이야기 생성'
                            )}
                        </button>
                    </div>

                    {error && (
                        <div className="text-red-700 text-center mb-6" role="alert">
                            <strong className="font-bold">오류:</strong>
                            <span className="block sm:inline ml-2">{error}</span>
                        </div>
                    )}

                    {story && (
                        <div className="mt-8 p-0">
                            <h2 className="text-2xl font-bold text-gray-700 mb-4">생성된 이야기:</h2>
                            <p className="text-gray-800 leading-relaxed whitespace-pre-wrap">{story}</p>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
